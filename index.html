<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Night Shelf — 書評SNS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: dark;
      --bg: #05030c;
      --panel: rgba(255, 255, 255, 0.04);
      --panel-strong: rgba(13, 12, 35, 0.75);
      --text: #f6f7fb;
      --muted: rgba(255, 255, 255, 0.7);
      --accent: #8b7bff;
      --accent-2: #ffce57;
      --border: rgba(255, 255, 255, 0.12);
      --comment-bg: rgba(255, 255, 255, 0.05);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Noto Sans JP", system-ui, sans-serif;
      background: radial-gradient(circle at top, rgba(139, 123, 255, 0.18), transparent 55%),
                  radial-gradient(circle at 20% 20%, rgba(255, 206, 87, 0.2), transparent 50%),
                  var(--bg);
      color: var(--text);
      padding: clamp(1.5rem, 3vw, 3rem);
    }

    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 2.5rem;
    }

    .hero {
      background: var(--panel-strong);
      border: 1px solid var(--border);
      border-radius: 32px;
      padding: clamp(2rem, 4vw, 3.5rem);
      position: relative;
      overflow: hidden;
    }

    .hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 70% 0%, rgba(255, 255, 255, 0.15), transparent 60%);
      pointer-events: none;
    }

    .hero-label {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: 0.85rem;
      background: rgba(255, 255, 255, 0.08);
      color: var(--muted);
      margin-bottom: 1rem;
    }

    .hero h1 {
      font-family: "Space Grotesk", "Noto Sans JP", sans-serif;
      font-size: clamp(2.8rem, 6vw, 4.5rem);
      margin: 0;
    }

    .hero h1 span {
      color: var(--accent-2);
    }

    .hero p {
      max-width: 640px;
      font-size: 1.1rem;
      color: var(--muted);
      line-height: 1.8;
      margin: 1rem 0 1.5rem;
    }

    .policies {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }

    .policy-card {
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(0, 0, 0, 0.18);
      padding: 1rem 1.25rem;
      font-size: 0.95rem;
      color: var(--muted);
      line-height: 1.6;
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1fr);
      gap: 2rem;
    }

    .panel {
      background: rgba(6, 8, 18, 0.8);
      border: 1px solid var(--border);
      border-radius: 28px;
      padding: clamp(1.5rem, 3vw, 2.5rem);
      position: relative;
      overflow: hidden;
    }

    .section-heading {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      margin-bottom: 1.5rem;
    }

    .section-heading span {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-size: 0.75rem;
      color: var(--muted);
    }

    .section-heading h2 {
      margin: 0;
      font-size: 1.8rem;
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.25rem;
    }

    .feature-card {
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(255, 255, 255, 0.02);
      padding: 1.25rem;
      display: grid;
      gap: 0.75rem;
    }

    .feature-card strong {
      font-size: 1.05rem;
    }

    .feature-card p {
      margin: 0;
      color: var(--muted);
      line-height: 1.6;
    }

    .feature-card em {
      font-style: normal;
      color: var(--accent-2);
      font-size: 0.9rem;
      letter-spacing: 0.08em;
    }

    .ranking-panel {
      background: linear-gradient(135deg, rgba(139, 123, 255, 0.12), rgba(5, 3, 12, 0.9));
    }

    .ranking-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.85rem;
    }

    .ranking-item {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.2rem;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(0, 0, 0, 0.2);
    }

    .rank-index {
      width: 42px;
      height: 42px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.08);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-family: "Space Grotesk", sans-serif;
    }

    .ranking-item strong {
      display: block;
      font-size: 1.05rem;
    }

    .ranking-item span {
      color: var(--muted);
      font-size: 0.85rem;
    }

    .trend-chip {
      border-radius: 999px;
      padding: 0.35rem 0.75rem;
      font-size: 0.8rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .trend-chip.up {
      color: #0fd976;
      border-color: #0fd976;
    }

    .trend-chip.new {
      color: var(--accent-2);
      border-color: var(--accent-2);
    }

    .mypage-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }

    .stat-card {
      border-radius: 18px;
      padding: 1.25rem;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(255, 255, 255, 0.02);
      display: grid;
      gap: 0.35rem;
    }

    .stat-card small {
      font-size: 0.8rem;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .stat-card strong {
      font-size: 1.8rem;
      font-family: "Space Grotesk", sans-serif;
    }

    .shelf-list {
      display: grid;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .shelf-card {
      display: grid;
      gap: 0.5rem;
      padding: 1rem;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(0, 0, 0, 0.25);
    }

    .shelf-card h3 {
      margin: 0;
      font-size: 1rem;
    }

    .shelf-progress {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
    }

    .shelf-progress span {
      display: block;
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(120deg, var(--accent-2), var(--accent));
    }

    .shelf-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .panel h2 {
      margin: 0 0 1rem;
      font-size: 1.4rem;
      font-family: "Space Grotesk", "Noto Sans JP", sans-serif;
      letter-spacing: 0.02em;
    }

    .panel small {
      color: var(--muted);
    }

    .book-search {
      margin-bottom: 1rem;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 1rem;
      background: rgba(0, 0, 0, 0.2);
      display: grid;
      gap: 0.75rem;
    }

    .book-search label {
      display: grid;
      gap: 0.35rem;
    }

    .book-search input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 0.75rem 1.1rem;
      background: rgba(0, 0, 0, 0.3);
      color: var(--text);
      font: inherit;
    }

    .search-results {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.5rem;
    }

    .search-results button {
      width: 100%;
      text-align: left;
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      padding: 0.75rem 1rem;
      cursor: pointer;
    }

    .search-results button strong {
      display: block;
      font-size: 1rem;
    }

    .search-results button span {
      display: block;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .search-status {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .feed {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .review-card {
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.03);
      padding: 1.5rem;
      display: grid;
      gap: 0.85rem;
    }

    .review-card header {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      gap: 0.75rem;
      justify-content: space-between;
    }

    .review-card h3 {
      margin: 0;
      font-size: 1.15rem;
    }

    .alias {
      font-size: 0.9rem;
      color: var(--muted);
    }

    .stars {
      position: relative;
      font-size: 1.1rem;
      letter-spacing: 0.15em;
      color: rgba(255, 255, 255, 0.25);
      font-family: "Space Grotesk", sans-serif;
    }

    .stars span {
      position: absolute;
      top: 0;
      left: 0;
      width: var(--fill, 100%);
      color: var(--accent-2);
      overflow: hidden;
      white-space: nowrap;
      pointer-events: none;
    }

    .review-card p {
      margin: 0;
      color: var(--muted);
      line-height: 1.6;
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .tag {
      padding: 0.25rem 0.65rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      font-size: 0.8rem;
      letter-spacing: 0.05em;
      color: var(--muted);
    }

    .comments {
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: var(--comment-bg);
      padding: 1rem;
      display: grid;
      gap: 0.75rem;
    }

    .comments h4 {
      margin: 0;
      font-size: 1rem;
    }

    .comment-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.65rem;
    }

    .comment-list li {
      padding: 0.65rem 0.85rem;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(0, 0, 0, 0.15);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .comment-list strong {
      display: block;
      color: var(--accent-2);
      margin-bottom: 0.2rem;
    }

    .comment-form {
      display: grid;
      gap: 0.65rem;
    }

    .comment-form label {
      display: grid;
      gap: 0.35rem;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .comment-form input,
    .comment-form textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(0, 0, 0, 0.15);
      color: var(--text);
      font: inherit;
      padding: 0.65rem 0.85rem;
      resize: none;
    }

    .comment-form textarea {
      min-height: 90px;
    }

    .comment-form button {
      justify-self: start;
      border: none;
      border-radius: 999px;
      padding: 0.55rem 1.2rem;
      font-size: 0.9rem;
      font-weight: 600;
      font-family: "Space Grotesk", sans-serif;
      color: #05030c;
      background: linear-gradient(120deg, #ffce57, #8b7bff);
      cursor: pointer;
    }

    form {
      display: grid;
      gap: 1rem;
    }

    label span {
      display: inline-block;
      margin-bottom: 0.35rem;
      font-size: 0.95rem;
      color: var(--muted);
    }

    input,
    textarea {
      width: 100%;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      font: inherit;
      padding: 0.85rem 1rem;
      resize: none;
    }

    textarea {
      min-height: 140px;
    }

    .rating-control {
      display: flex;
      gap: 0.5rem;
    }

    .rating-control button {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.03);
      color: rgba(255, 255, 255, 0.4);
      font-size: 1.1rem;
      cursor: pointer;
      transition: transform 160ms ease, border-color 160ms ease, color 160ms ease;
    }

    .rating-control button.active {
      color: var(--accent-2);
      border-color: var(--accent-2);
      transform: translateY(-3px);
      background: rgba(255, 206, 87, 0.08);
    }

    .rating-control button:focus-visible {
      outline: 2px solid var(--accent-2);
      outline-offset: 3px;
    }

    .submit {
      border: none;
      border-radius: 24px;
      padding: 0.95rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      font-family: "Space Grotesk", sans-serif;
      color: #05030c;
      background: linear-gradient(120deg, #ffce57, #8b7bff);
      cursor: pointer;
      transition: transform 160ms ease;
    }

    .submit:hover {
      transform: translateY(-2px);
    }

    .helper {
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: -0.5rem;
    }

    .form-status {
      min-height: 1.2rem;
      font-size: 0.9rem;
      color: var(--accent-2);
    }

    footer {
      text-align: center;
      padding: 1.5rem 0 2rem;
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.55);
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      body {
        padding: 1rem;
      }

      .hero {
        border-radius: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="hero">
      <div class="hero-label">Night Shelf / Review SNS</div>
      <h1>匿名でつなぐ<span>書評</span>コミュニティ</h1>
      <p>Night Shelfは、読んだ人の一次体験だけを共有するスペース。推測や引用元不明の情報は流さず、読了の温度を事実とともに残していきます。</p>
      <div class="policies">
        <div class="policy-card">引用・要約は必ず原著を確認してから投稿。根拠のない断言や噂話は書かないこと。</div>
        <div class="policy-card">書誌情報はISBNなど一次ソースでセルフチェック。誤情報を見つけたらコメントで貢献しよう。</div>
        <div class="policy-card">AI生成文や広告は不可。1レビュー1感想というシンプルなルールを守ります。</div>
      </div>
    </section>

    <div class="grid">
      <section class="panel">
        <h2>最新レビュー</h2>
        <small>※ 誤情報を見つけた場合はコメント欄で根拠を添えて知らせてください。</small>
        <div id="review-feed" class="feed" aria-live="polite"></div>
      </section>

      <section class="panel">
        <h2>レビューを追加</h2>
        <form id="review-form">
          <div class="book-search">
            <label>
              <span>まず書名を検索して選択してください *</span>
              <input type="search" id="book-search" placeholder="例: サピエンス全史" autocomplete="off" />
            </label>
            <ul id="search-results" class="search-results" aria-live="polite"></ul>
            <p id="search-status" class="search-status"></p>
          </div>
          <label>
            <span>本のタイトル *</span>
            <input type="text" name="title" id="book-title" placeholder="書名検索から自動入力" required readonly />
          </label>
          <label>
            <span>ハンドルネーム (任意)</span>
            <input type="text" name="alias" id="book-alias" placeholder="未入力なら匿名になります" />
          </label>
          <label>
            <span>星評価 (5段階) *</span>
            <div class="rating-control" role="radiogroup" aria-label="星評価">
              <button type="button" data-rating-button="1" aria-label="1星">★</button>
              <button type="button" data-rating-button="2" aria-label="2星">★</button>
              <button type="button" data-rating-button="3" aria-label="3星">★</button>
              <button type="button" data-rating-button="4" aria-label="4星">★</button>
              <button type="button" data-rating-button="5" aria-label="5星">★</button>
            </div>
          </label>
          <label>
            <span>コメント *</span>
            <textarea name="comment" id="book-comment" placeholder="本当に心を動かしたポイントを書いてください" required></textarea>
          </label>
          <button class="submit" type="submit">レビューを投稿</button>
          <p class="helper">※ 書誌情報に誤りがあった場合はコミュニティの判断で非公開になることがあります。</p>
          <div id="form-status" class="form-status" aria-live="polite"></div>
        </form>
      </section>
    </div>

    <section class="panel">
      <div class="section-heading">
        <span>書評SNS</span>
        <h2>Night Shelfでできる3つのこと</h2>
      </div>
      <div class="feature-grid">
        <article class="feature-card">
          <em>匿名×一次ソース</em>
          <strong>書誌情報付きの短評投稿</strong>
          <p>ISBNでひも付けられたレビューだけが投稿され、推測や引用不明の噂は流れません。一次情報を大事にする人のためのタイムラインです。</p>
        </article>
        <article class="feature-card">
          <em>対話で磨く</em>
          <strong>コメントのやり取り</strong>
          <p>レビューごとに根拠を添えたコメントが集まり、誤情報を見つけたらすぐに指摘できます。納得感のある議論だけが残ります。</p>
        </article>
        <article class="feature-card">
          <em>テーマで追う</em>
          <strong>タグベースの棚づくり</strong>
          <p>#歴史、#翻訳もの など自分の視点で並べたタグをフォローするだけで、興味の近い人の書評が集まります。</p>
        </article>
      </div>
    </section>

    <section class="panel ranking-panel">
      <div class="section-heading">
        <span>ランキング</span>
        <h2>いま注目されている本</h2>
      </div>
      <ol class="ranking-list">
        <li class="ranking-item">
          <div class="rank-index">1</div>
          <div>
            <strong>サピエンス全史</strong>
            <span>週内レビュー 42件 / 平均4.8</span>
          </div>
          <div class="trend-chip up">+5</div>
        </li>
        <li class="ranking-item">
          <div class="rank-index">2</div>
          <div>
            <strong>罪と罰</strong>
            <span>週内レビュー 35件 / 平均4.9</span>
          </div>
          <div class="trend-chip up">+2</div>
        </li>
        <li class="ranking-item">
          <div class="rank-index">3</div>
          <div>
            <strong>ハチドリのひとしずく</strong>
            <span>週内レビュー 29件 / 平均4.2</span>
          </div>
          <div class="trend-chip new">NEW</div>
        </li>
        <li class="ranking-item">
          <div class="rank-index">4</div>
          <div>
            <strong>金閣寺</strong>
            <span>週内レビュー 24件 / 平均4.5</span>
          </div>
          <div class="trend-chip">=</div>
        </li>
      </ol>
    </section>

    <section class="panel mypage-panel">
      <div class="section-heading">
        <span>マイページ</span>
        <h2>自分のペースで棚を育てる</h2>
      </div>
      <div class="mypage-grid">
        <div class="stat-card">
          <small>読書連続日数</small>
          <strong>18</strong>
          <span>ナイトモード達成まであと 12日</span>
        </div>
        <div class="stat-card">
          <small>公開レビュー</small>
          <strong>57</strong>
          <span>レビュー草稿 3件が承認待ち</span>
        </div>
        <div class="stat-card">
          <small>フォロー中の棚</small>
          <strong>11</strong>
          <span>文学系 6 / ノンフィクション 5</span>
        </div>
      </div>
      <div class="shelf-list">
        <article class="shelf-card">
          <h3>深夜に読み返すエッセイ</h3>
          <div class="shelf-progress" aria-label="進捗 70%">
            <span style="width: 70%"></span>
          </div>
          <div class="shelf-meta">
            <span>登録 14冊</span>
            <span>レビュー済み 10冊</span>
          </div>
        </article>
        <article class="shelf-card">
          <h3>翻訳で読む現代詩</h3>
          <div class="shelf-progress" aria-label="進捗 45%">
            <span style="width: 45%"></span>
          </div>
          <div class="shelf-meta">
            <span>登録 9冊</span>
            <span>レビュー済み 4冊</span>
          </div>
        </article>
      </div>
    </section>

    <footer>© 2024 Night Shelf — 読んだ人が責任を持って語る書評SNS</footer>
  </div>

  <script>
    const form = document.getElementById('review-form');
    const statusEl = document.getElementById('form-status');
    const feed = document.getElementById('review-feed');
    const ratingButtons = Array.from(document.querySelectorAll('[data-rating-button]'));
    const searchInput = document.getElementById('book-search');
    const searchResults = document.getElementById('search-results');
    const searchStatus = document.getElementById('search-status');
    const titleInput = document.getElementById('book-title');
    let currentRating = 0;
    let selectedBook = null;

    const catalog = [
      {
        id: '9784309226710',
        title: 'サピエンス全史',
        author: 'ユヴァル・ノア・ハラリ',
        publisher: '河出書房新社'
      },
      {
        id: '9784103132125',
        title: '金閣寺',
        author: '三島由紀夫',
        publisher: '新潮社'
      },
      {
        id: '9784102020133',
        title: '罪と罰',
        author: 'フョードル・ドストエフスキー',
        publisher: '新潮社'
      },
      {
        id: '9784103534226',
        title: 'ノルウェイの森',
        author: '村上春樹',
        publisher: '講談社'
      },
      {
        id: '9784000265861',
        title: '1Q84',
        author: '村上春樹',
        publisher: '新潮社'
      },
      {
        id: '9784101104216',
        title: '人間失格',
        author: '太宰治',
        publisher: '新潮社'
      }
    ];

    function resetSearchState() {
      selectedBook = null;
      titleInput.value = '';
      if (searchInput) searchInput.value = '';
      searchResults.innerHTML = '';
      searchStatus.textContent = '書名を入力すると出版社・著者付きの候補が表示されます。';
    }

    function renderSearchList(keyword) {
      const normalized = keyword.trim();
      searchResults.innerHTML = '';
      if (!normalized) {
        resetSearchState();
        return;
      }

      const matches = catalog.filter(book => {
        const target = `${book.title}${book.author}`.toLowerCase();
        return target.includes(normalized.toLowerCase());
      }).slice(0, 6);

      if (matches.length === 0) {
        searchStatus.textContent = '一致する書籍が見つかりませんでした。別のキーワードを試してください。';
        return;
      }

      matches.forEach(book => {
        const item = document.createElement('li');
        const button = document.createElement('button');
        button.type = 'button';
        button.dataset.bookId = book.id;
        button.innerHTML = `<strong>${book.title}</strong><span>${book.author} / ${book.publisher}</span>`;
        item.appendChild(button);
        searchResults.appendChild(item);
      });
      searchStatus.textContent = `${matches.length}件ヒットしました。タイトルをクリックして確定してください。`;
    }

    searchInput.addEventListener('input', (event) => {
      selectedBook = null;
      titleInput.value = '';
      renderSearchList(event.target.value);
    });

    searchResults.addEventListener('click', (event) => {
      const button = event.target.closest('button[data-book-id]');
      if (!button) return;
      const book = catalog.find(entry => entry.id === button.dataset.bookId);
      if (!book) return;
      selectedBook = book;
      titleInput.value = book.title;
      searchInput.value = book.title;
      searchResults.innerHTML = '';
      searchStatus.textContent = `${book.title}（${book.author}）を選択済み。`;
    });

    resetSearchState();

    const reviews = [
      {
        id: generateId(),
        title: 'サピエンス全史',
        alias: 'anonymous',
        rating: 5,
        comment: '認知革命から貨幣・国家までを同じ視点で語る大胆さが好き。章ごとに止めても心がざわつく。',
        tags: ['#歴史', '#ノンフィクション'],
        comments: [
          { id: generateId('c'), alias: '灯台下暗し', text: '第2部の宗教パートだけ読み直しました。比喩が鮮烈。' }
        ]
      },
      {
        id: generateId(),
        title: '金閣寺',
        alias: 'midnight-reader',
        rating: 4,
        comment: '言葉の密度が高くて一段落ごとに息継ぎしたくなる。美に飲み込まれていく速度が異常。',
        tags: ['#日本文学', '#三島由紀夫'],
        comments: [
          { id: generateId('c'), alias: 'kyoto-walk', text: '終盤の独白、声に出すと余韻が長い。' }
        ]
      },
      {
        id: generateId(),
        title: '罪と罰',
        alias: '匿名読者',
        rating: 5,
        comment: '自責と救済のゆらめきが続くのに、警察パートは完全にスリラー。再読ベスト3入り確定。',
        tags: ['#ロシア文学', '#古典'],
        comments: []
      }
    ];

    function generateId(prefix = 'r') {
      return `${prefix}-${Math.random().toString(36).slice(2, 9)}`;
    }

    function updateRatingUI(value) {
      currentRating = value;
      ratingButtons.forEach((button, index) => {
        const isActive = index < value;
        button.classList.toggle('active', isActive);
      });
    }

    ratingButtons.forEach(button => {
      button.addEventListener('click', () => {
        const value = Number(button.dataset.ratingButton);
        updateRatingUI(value);
      });
    });

    function createStars(rating) {
      const stars = document.createElement('div');
      stars.className = 'stars';
      stars.setAttribute('aria-label', `評価 ${rating} / 5`);
      const fill = document.createElement('span');
      fill.style.setProperty('--fill', `${(rating / 5) * 100}%`);
      fill.textContent = '★★★★★';
      stars.appendChild(fill);
      stars.append('★★★★★');
      return stars;
    }

    function createTagElements(tags) {
      if (!tags || tags.length === 0) return null;
      const wrapper = document.createElement('div');
      wrapper.className = 'tags';
      tags.forEach(tag => {
        const chip = document.createElement('div');
        chip.className = 'tag';
        chip.textContent = tag;
        wrapper.appendChild(chip);
      });
      return wrapper;
    }

    function createCommentsSection(review) {
      const container = document.createElement('div');
      container.className = 'comments';

      const heading = document.createElement('h4');
      heading.textContent = 'コメント';
      container.appendChild(heading);

      const list = document.createElement('ul');
      list.className = 'comment-list';

      if (review.comments.length === 0) {
        const empty = document.createElement('li');
        const strong = document.createElement('strong');
        strong.textContent = 'まだコメントはありません';
        empty.appendChild(strong);
        const span = document.createElement('span');
        span.textContent = '最初のひと言を残しませんか？';
        empty.appendChild(span);
        list.appendChild(empty);
      } else {
        review.comments.forEach(comment => {
          const item = document.createElement('li');
          const strong = document.createElement('strong');
          strong.textContent = comment.alias || '匿名コメント';
          item.appendChild(strong);
          const span = document.createElement('span');
          span.textContent = comment.text;
          item.appendChild(span);
          list.appendChild(item);
        });
      }

      container.appendChild(list);

      const form = document.createElement('form');
      form.className = 'comment-form';
      form.dataset.reviewId = review.id;

      const aliasField = document.createElement('label');
      aliasField.innerHTML = '<span>名前 (任意)</span>';
      const aliasInput = document.createElement('input');
      aliasInput.type = 'text';
      aliasInput.name = 'comment-alias';
      aliasInput.placeholder = '匿名でもOK';
      aliasField.appendChild(aliasInput);

      const commentField = document.createElement('label');
      commentField.innerHTML = '<span>コメント *</span>';
      const commentTextarea = document.createElement('textarea');
      commentTextarea.name = 'comment-body';
      commentTextarea.required = true;
      commentTextarea.placeholder = 'レビューのどこに共感したかを書いてください';
      commentField.appendChild(commentTextarea);

      const submitBtn = document.createElement('button');
      submitBtn.type = 'submit';
      submitBtn.textContent = 'コメントを送信';

      form.append(aliasField, commentField, submitBtn);
      container.appendChild(form);

      return container;
    }

    function createReviewCard(review) {
      const article = document.createElement('article');
      article.className = 'review-card';

      const header = document.createElement('header');
      const heading = document.createElement('h3');
      heading.textContent = review.title;
      header.append(heading, createStars(review.rating));

      const alias = document.createElement('div');
      alias.className = 'alias';
      alias.textContent = review.alias || '匿名読者';

      const body = document.createElement('p');
      body.textContent = review.comment;

      article.append(header, alias, body);

      const tags = createTagElements(review.tags);
      if (tags) article.appendChild(tags);

      article.appendChild(createCommentsSection(review));
      return article;
    }

    function renderReviews() {
      feed.innerHTML = '';
      reviews.forEach(review => {
        feed.appendChild(createReviewCard(review));
      });
    }

    feed.addEventListener('submit', (event) => {
      if (!event.target.classList.contains('comment-form')) return;
      event.preventDefault();
      const formEl = event.target;
      const reviewId = formEl.dataset.reviewId;
      const alias = formEl.querySelector('[name="comment-alias"]').value.trim();
      const text = formEl.querySelector('[name="comment-body"]').value.trim();

      if (!text) return;

      const targetReview = reviews.find(r => r.id === reviewId);
      if (!targetReview) return;

      targetReview.comments.unshift({
        id: generateId('c'),
        alias,
        text
      });

      renderReviews();
    });

    form.addEventListener('submit', (event) => {
      event.preventDefault();
      const title = form.querySelector('#book-title').value.trim();
      const alias = form.querySelector('#book-alias').value.trim();
      const comment = form.querySelector('#book-comment').value.trim();

      if (!title || !comment || currentRating === 0) {
        statusEl.textContent = 'タイトル、コメント、星評価は必須です。';
        return;
      }

      if (!selectedBook || selectedBook.title !== title) {
        statusEl.textContent = '検索候補から書名を選択して確定してください。';
        return;
      }

      reviews.unshift({
        id: generateId(),
        title,
        alias,
        rating: currentRating,
        comment,
        tags: [`#ISBN:${selectedBook.id}`, '#ユーザー投稿'],
        comments: []
      });

      renderReviews();

      form.reset();
      updateRatingUI(0);
      resetSearchState();
      statusEl.textContent = '投稿しました。確認後に公開されます。';
      setTimeout(() => (statusEl.textContent = ''), 2500);
    });

    renderReviews();
  </script>
</body>
</html>
